{% extends "base.html" %}

{% block content %}
<div class="main-content">
    <section class="hero-section">
        <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</p>
    </section>

    <section class="section">
        {% if cart %}
            <div class="cart-items">
                {% for item in cart %}
                <div class="cart-item">
                    <h3>{{ item.hotel.name }}</h3>
                    <p>–ù–æ–º–µ—Ä: {{ item.room.name }}</p>
                    <p>–î–∞—Ç—ã: {{ item.checkin }} - {{ item.checkout }}</p>
                    <p>–ì–æ—Å—Ç–∏: {{ item.guests }}</p>
                    <p class="price">${{ item.price }}</p>
                </div>
                {% endfor %}
            </div>
            <div class="cart-total">
                <h3>–ò—Ç–æ–≥–æ: ${{ cart_total }}</h3>
                <button class="btn btn-primary" onclick="processCheckout()">
                    üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
                </button>
                
                <script>
                async function processCheckout() {
                    if(!confirm('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')) return;
                    
                    const btn = document.querySelector('.btn-primary');
                    btn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
                    btn.disabled = true;
                
                    try {
                        const response = await fetch('/api/checkout', {
                            method: 'POST'
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            // –û—á–∏—â–∞–µ–º localStorage —Ç–æ–∂–µ, —á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                            localStorage.removeItem('hotel_cart'); 
                            
                            alert(`–£—Å–ø–µ—à–Ω–æ! –ë—Ä–æ–Ω—å #${result.booking_id} –æ–ø–ª–∞—á–µ–Ω–∞.`);
                            window.location.href = '/booking'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ "–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + result.error);
                            btn.disabled = false;
                            btn.innerHTML = 'üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å';
                        }
                    } catch (e) {
                        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                        console.error(e);
                    }
                }
                </script>
            </div>
        {% else %}
            <div class="text-center">
                <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                <a href="/hotels" class="btn btn-primary mt-2">–ù–∞–π—Ç–∏ –æ—Ç–µ–ª–∏</a>
            </div>
        {% endif %}
    </section>
</div>
{% endblock %}